@using SancionadosSAGB2025.Shared.Moral
@using SancionadosSAGB2025.Client.Services
@using SancionadosSAGB2025.Shared.Sanciones;
@using System.ComponentModel.DataAnnotations;
@using Microsoft.AspNetCore.Components.Forms;
@using SancionadosSAGB2025.Client.Shared.Partial.Cards;
@inject CatalagosServiceClient CatalagosService
@inject AuthService AuthService
@inject NavigationManager Navigation;
@inject IDialogService DialogService
@inject HttpClient _http
@inject ISnackbar Snackbar;

        <CardForm>            
            <Content>
        @if (personaMoralEntidadVistaEdicion is not null)
        {
            <MudItem xs="12" class="d-flex justify-end pb-5">
                <MudButton StartIcon="@Icons.Material.Filled.KeyboardBackspace" Class="mt-3 w-25" Variant="Variant.Filled" Color="Color.Primary" OnClick="Regresar">
                    Volver a Buscar Servidores
                </MudButton>
            </MudItem>
        }
        else
        {
            @if (_modelo.Id is not null)
            {
                <MudItem xs="12" class="d-flex justify-end pb-5">
                    <MudButton StartIcon="@Icons.Material.Filled.Edit" Class="mt-3 w-25" Variant="Variant.Filled" Color="Color.Primary" OnClick="CancelarForm">
                        Cancelar registro
                    </MudButton>
                </MudItem>
            }
            else
            {
                <MudItem xs="12" class="d-flex justify-end pb-5">
                    <MudButton StartIcon="@Icons.Material.Filled.KeyboardBackspace" Class="mt-3 w-25" Variant="Variant.Filled" Color="Color.Primary" Href="FaltasGravesPersonasMorales">
                        Volver a Buscar Servidores
                    </MudButton>
                </MudItem>
            }

        }
        <MudStepper NonLinear="modoVista" @bind-ActiveIndex="index" ShowResetButton OnPreviewInteraction="OnPreviewInteraction" Vertical="true">
                        <ChildContent>
                        <MudStep Title="1. FECHA* (DD-MM-AAAA)*" CompletedStepColor="Color.Success">

                                <MudForm @ref="_formFecha" @bind-IsValid="_isStep1Valid[0]">
                                    <MudDatePicker Label="Fecha"
                                                   @bind-Date="_modelo.Fecha"
                                                   Disabled="modoVista"
                                                   ErrorText="La Fecha es Requerida"
                                                   Required="!modoVista" />
                                </MudForm>
                            </MudStep>
                        <MudStep Title="2. EXPEDIENTE*" CompletedStepColor="Color.Success">
                                <MudForm @ref="_formExpediente" @bind-IsValid="_isStep1Valid[1]">
                                    <MudTextField Label="EXPEDIENTE"
                                                  @bind-Value="_modelo.Expediente"
                                                  Disabled="modoVista"
                                                  ErrorText="El Expediente es requerido"
                                                  Required="!modoVista" />
                                </MudForm>
                            </MudStep>
                        <MudStep Title="3. DATOS GENERALES DE LA PERSONA MORAL SANCIONADA*" CompletedStepColor="Color.Success">
                            <MudForm @ref="_formDatosGenerales" @bind-IsValid="_isStep1Valid[2]">
                                <MudPaper Class="pa-3">
                                    <MudGrid>

                                        <MudItem xs="12" sm="6">
                                            <MudTextField Label="Denominación o Razón Social"
                                                          @bind-Value="_modelo.DatosGenerales.Nombres"
                                                          ErrorText="La Denominación o Razón Social es requerido"
                                                          Disabled="modoVista"
                                                          Required="!modoVista" FullWidth="true" />
                                        </MudItem>
                                        <MudItem xs="12" sm="6">
                                            <MudTextField Label="RFC con Homoclave"
                                                          T="string"
                                                          @bind-Value="_modelo.DatosGenerales.Rfc"
                                                          ErrorText="El RFC es requerido"
                                                          Disabled="modoVista"
                                                          For="@(()=>_modelo.DatosGenerales.Rfc!)"
                                                          MaxLength="12" Required="!modoVista" FullWidth="true" />
                                        </MudItem>
                                        <MudItem xs="12">
                                            <MudTextField Label="Objeto Social"
                                                          Disabled="modoVista"
                                                          @bind-Value="_modelo.DatosGenerales.PrimerApellido"
                                                          FullWidth="true" />
                                        </MudItem>


                                        <MudItem xs="4">
                                            <MudSelect @bind-Value="TipoDomicilioSeleccionado"
                                                       Disabled="modoVista"
                                                       Label="Tipo Domicilio"
                                                       HelperText="Selecciona la opción que corresponda: MEXICO, EXTRANJERO">
                                                @foreach (var tipo in TipoDomicilios)
                                                {
                                                    <MudSelectItem Value="@tipo">@tipo</MudSelectItem>
                                                }
                                            </MudSelect>
                                        </MudItem>
                                        @if (TipoDomicilioSeleccionado == TipoDomiclio.MEXICO)
                                        {
                                            <MudItem xs="12"><MudText Align="Align.Center" Typo="Typo.h6">DOMICILIO EN LA REPÚBLICA MEXICANA</MudText></MudItem>
                                            <MudItem xs="4">
                                                <MudSelect @bind-Value="_modelo.DatosGenerales.DomicilioMexico.IdTipoVialidadFK"
                                                           Label="TIPO DE VIALIDAD Ejemplo: CALLE"
                                                           Disabled="modoVista"
                                                           HelperText="Colocar el tipo de la vialidad correspondiente con base al catálogo de vialidades del marco Geoestadístico Nacional. ">
                                                    @foreach (var vialidad in TiposVialidades)
                                                    {
                                                        <MudSelectItem Value="@(vialidad.IdTipoVialidad as int?)">@vialidad.Descripcion</MudSelectItem>
                                                    }
                                                </MudSelect>
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioMexico.NombreVialidad"
                                                              Disabled="modoVista"
                                                              HelperText="Escribir el nombre completo de la calle, boulevard, avenida, etc."
                                                              label="NOMBRE DE LA VIALIDAD" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioMexico.NumeroExterior"
                                                              Disabled="modoVista"
                                                              Error="@(!EsValido(_modelo!.DatosGenerales!.DomicilioMexico.NumeroExterior))"
                                                              ErrorText="Solo letras, números y espacios"
                                                              HelperText="Escribir el número exterior."
                                                              label="NÚMERO EXTERIOR" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioMexico.NumeroInterior"
                                                              Disabled="modoVista"
                                                              Error="@(!EsValido(_modelo!.DatosGenerales!.DomicilioMexico.NumeroInterior))"
                                                              ErrorText="Solo letras, números y espacios"
                                                              HelperText="Escribir el número interior."
                                                              label="NÚMERO INTERIOR" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioMexico.ColoniaLocalidad"
                                                              Disabled="modoVista"
                                                              Error="@(!EsValido(_modelo!.DatosGenerales!.DomicilioMexico.ColoniaLocalidad))"
                                                              ErrorText="Solo letras, números y espacios"
                                                              HelperText="Escribir el nombre completo de la colonia."
                                                              label="COLONIA/LOCALIDAD" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioMexico.MunicipioAlcaldia"
                                                              Disabled="modoVista"
                                                              Error="@(!EsValido(_modelo!.DatosGenerales!.DomicilioMexico.MunicipioAlcaldia))"
                                                              ErrorText="Solo letras, números y espacios"
                                                              HelperText="Nombre del municipio/alcaldia."
                                                              label="MUNICIPIO/ALCALDÍA" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioMexico.CodigoPostal"
                                                              Disabled="modoVista"
                                                              Error="@(!EsValido(_modelo!.DatosGenerales!.DomicilioMexico.CodigoPostal))"
                                                              ErrorText="Solo letras, números y espacios"
                                                              HelperText="Escribir el número código postal."
                                                              label="CÓDIGO POSTAL" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudSelect @bind-Value="_modelo.DatosGenerales.DomicilioMexico.IdEntidadFederativaFK"
                                                           Disabled="modoVista"
                                                           Label="ENTIDAD FEDERATIVA"
                                                           HelperText="Seleccionar la entidad federativa...">
                                                    @foreach (var entidad in EntidadesFederativas)
                                                    {
                                                        <MudSelectItem Value="@(entidad.IdEntidadFederativa as int?)">@entidad.Descripcion</MudSelectItem>
                                                    }
                                                </MudSelect>

                                            </MudItem>

                                        }
                                        @if (TipoDomicilioSeleccionado == TipoDomiclio.EXTRANJERO)
                                        {
                                            <MudItem xs="12">
                                                <MudText Align="Align.Center" Typo="Typo.h6">
                                                    DOMICILIO EN EL EXTRANJERO
                                                </MudText>
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioExtranjero.Ciudad"
                                                              Disabled="modoVista"
                                                              HelperText="Escribir el nombre completo de la calle, boulevard, avenida, etc."
                                                              label="CIUDAD/LOCALIDAD" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioExtranjero.Provincia"
                                                              Disabled="modoVista"
                                                              HelperText="Escribir el nombre completo de la colonia."
                                                              label="ESTADO/PROVINCIA" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioExtranjero.Calle"
                                                              Disabled="modoVista"
                                                              HelperText="Nombre de la Calle."
                                                              label="CALLE" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioExtranjero.NumeroExterior"
                                                              Disabled="modoVista"
                                                              Error="@(!EsValido(_modelo!.DatosGenerales!.DomicilioExtranjero.NumeroExterior))"
                                                              ErrorText="Solo letras, números y espacios"
                                                              HelperText="Escribir el número exterior."
                                                              label="NÚMERO EXTERIOR" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudTextField @bind-value="_modelo!.DatosGenerales!.DomicilioExtranjero.NumeroInterior"
                                                              Disabled="modoVista"
                                                              Error="@(!EsValido(_modelo!.DatosGenerales!.DomicilioExtranjero.NumeroInterior))"
                                                              ErrorText="Solo letras, números y espacios"
                                                              HelperText="Escribir el número interior."
                                                              label="NÚMERO INTERIOR" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudNumericField @bind-value="_modelo!.DatosGenerales!.DomicilioExtranjero.CodigoPostal"
                                                                 Disabled="modoVista"
                                                                 HelperText="Escribir el número código postal."
                                                                 label="CÓDIGO POSTAL" />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudSelect @bind-Value="_modelo.DatosGenerales.DomicilioExtranjero.Pais"
                                                           Disabled="modoVista"
                                                           Label="PAÍS"
                                                           HelperText="Seleccionar el pais en donde se realizó la falta.">
                                                    @foreach (var pais in Paises)
                                                    {
                                                        <MudSelectItem Value="@pais.codigoISO">@pais.nombrePais</MudSelectItem>
                                                    }
                                                </MudSelect>
                                            </MudItem>
                                        }

                                    </MudGrid>
                                </MudPaper>
                            </MudForm>
                        </MudStep>
                        <MudStep Title="4. DATOS GENERALES DEL DIRECTOR GENERAL*" CompletedStepColor="Color.Success">
                            <MudForm @ref="_formDatosDirectorGeneral" Model="_modelo" @bind-IsValid="_isStep1Valid[3]">
                                <MudPaper Class="pa-3">
                                    <MudGrid>
                                        <MudItem xs="12">
                                            <MudText Color="Color.Primary" Align="Align.Center" Typo="Typo.h6" Class="mb-4">
                                                <b>DIRECTOR GENERAL DE LA PERSONA MORAL*</b>
                                            </MudText>
                                        </MudItem>

                                        <MudItem xs="4">
                                            <MudTextField Label="Nombre(s)"
                                                          @bind-Value="_modelo!.DirectorGeneral.Nombres"
                                                          ErrorText="El nombre es requerido"
                                                          Disabled="modoVista"
                                                          For="@(() => _modelo!.DirectorGeneral.Nombres)"
                                                          MaxLength="100"
                                                          Required="!modoVista" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField Label="Primer Apellido"
                                                          @bind-Value="_modelo!.DirectorGeneral.PrimerApellido"
                                                          ErrorText="El Primer Apellido es requrido"
                                                          Disabled="modoVista"
                                                          For="@(() => _modelo!.DirectorGeneral.PrimerApellido)"
                                                          MaxLength="50"
                                                          Required="!modoVista" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField Label="Segundo Apellido"
                                                          @bind-Value="_modelo!.DirectorGeneral.SegundoApellido"
                                                          Disabled="modoVista"
                                                          For="@(() => _modelo!.DirectorGeneral.SegundoApellido)"
                                                          MaxLength="50" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField Label="RFC con Homoclave"
                                                          @bind-Value="_modelo.DirectorGeneral.Rfc"
                                                          Disabled="modoVista"
                                                          For="@(() => _modelo.DirectorGeneral.Rfc!)"
                                                          MaxLength="13"
                                                          Required="!modoVista" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField Label="CURP"
                                                          @bind-Value="_modelo!.DirectorGeneral.Curp"
                                                          Disabled="modoVista"
                                                          For="@(() => _modelo!.DirectorGeneral.Curp)"
                                                          MaxLength="18" />
                                        </MudItem>
                                        <br />
                                        <MudItem xs="12">
                                            <MudText Color="Color.Primary" Align="Align.Center" Typo="Typo.h6" Class="mb-4">
                                                <b>DATOS DEL REPRESENTANTE LEGAL DE LA PERSONA MORAL*</b>
                                            </MudText>
                                        </MudItem>

                                        <MudItem xs="4">
                                            <MudTextField Label="Nombre(s)"
                                                          @bind-Value="_modelo!.DirectorGeneral.RepresentanteLegal.Nombres"
                                                          ErrorText="El nombre es requerido"
                                                          Disabled="modoVista"
                                                          For="@(() => _modelo!.DirectorGeneral.RepresentanteLegal.Nombres)"
                                                          MaxLength="100"
                                                          Required="!modoVista" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField Label="Primer Apellido"
                                                          @bind-Value="_modelo!.DirectorGeneral.RepresentanteLegal.PrimerApellido"
                                                          ErrorText="El Primer Apellido es requrido"
                                                          Disabled="modoVista"
                                                          For="@(() => _modelo!.DirectorGeneral.RepresentanteLegal.PrimerApellido)"
                                                          MaxLength="50"
                                                          Required="!modoVista" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField Label="Segundo Apellido"
                                                          @bind-Value="_modelo!.DirectorGeneral.RepresentanteLegal.SegundoApellido"
                                                          Disabled="modoVista"
                                                          For="@(() => _modelo!.DirectorGeneral.RepresentanteLegal.SegundoApellido)"
                                                          MaxLength="50" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField Label="RFC con Homoclave"
                                                          @bind-Value="_modelo.DirectorGeneral.RepresentanteLegal.Rfc"
                                                          Disabled="modoVista"
                                                          For="@(() => _modelo.DirectorGeneral.RepresentanteLegal.Rfc!)"
                                                          MaxLength="13"
                                                          Required="!modoVista" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField Label="CURP"
                                                          @bind-Value="_modelo!.DirectorGeneral.RepresentanteLegal.Curp"
                                                          Disabled="modoVista"
                                                          For="@(() => _modelo!.DirectorGeneral.RepresentanteLegal.Curp)"
                                                          MaxLength="18" />
                                        </MudItem>
                                        <br />

                                    </MudGrid>
                                </MudPaper>                             
                            </MudForm>
                           </MudStep>
                        <MudStep Title="5. DATOS DEL ENTE PÚBLICO DONDE SE COMETIÓ LA FALTA ADMINISTRATIVA*" CompletedStepColor="Color.Success">
                            <MudForm @ref="_formDatosEntePublico" Model="_modelo" @bind-IsValid="_isStep1Valid[4]">
                                <MudPaper Class="pa-4 mx-auto" Style="max-width: 70vw;">
                                    <MudGrid>
                                        <MudItem xs="4">
                                            <MudSelect @bind-Value="_modelo!.EmpleoCargoComision!.IdEntidadFederativaFK"
                                                       Label="ENTIDAD FEDERATIVA"
                                                       Disabled="modoVista"
                                                       Required="!modoVista"
                                                       RequiredError="El campo de Entidad Federativa es obligatorio."
                                                       HelperText="Seleccionar la entidad federativa donde se ubica el Ente público donde labora o laboraba la persona servidora pública sancionada, al momento de cometer la falta administrativa. ">
                                                @foreach (var entidad in EntidadesFederativas)
                                                {
                                                    <MudSelectItem Value="@entidad.IdEntidadFederativa">@entidad.Descripcion</MudSelectItem>
                                                }
                                            </MudSelect>

                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudSelect @bind-Value="_modelo!.EmpleoCargoComision!.IdNivelOrdenGobiernoFK"
                                                       Label="NIVEL/ORDEN DE GOBIERNO"
                                                       Disabled="modoVista"
                                                       Required="!modoVista"
                                                       RequiredError="El campo de Nivel Orden Gobierno es obligatorio."
                                                       HelperText="Seleccionar el nivel u orden de gobierno">
                                                @if (NivelOrdenGobierno is not null)
                                                {
                                                    @foreach (var nivel in NivelOrdenGobierno)
                                                    {
                                                        <MudSelectItem Value="@nivel.IdNivelOrdenGobierno">@nivel.Descripcion</MudSelectItem>
                                                    }
                                                }
                                            </MudSelect>
                                        </MudItem>

                                        <MudItem xs="4">
                                            <MudSelect @bind-Value="_modelo!.EmpleoCargoComision!.IdAmbitoPublicoFK"
                                                       Label="ÁMBITO PÚBLICO"
                                                       Disabled="modoVista"
                                                       Required="!modoVista"
                                                       RequiredError="El campo de Ambito Publico es obligatorio."
                                                       HelperText="Seleccionar el ámbito público">
                                                @foreach (var ambito in AmbitoPublico)
                                                {
                                                    <MudSelectItem Value="@ambito.IdAmbitoPublico">@ambito.Descripcion</MudSelectItem>
                                                }
                                            </MudSelect>
                                        </MudItem>

                                        <MudItem xs="4">
                                            <MudTextField @bind-value="_modelo!.EmpleoCargoComision!.NombreEnte"
                                                          label="NOMBRE DEL ENTE PÚBLICO"
                                                          Disabled="modoVista"
                                                          helpertext="Indicar el nombre completo del Ente público, sin abreviaturas, sin acentos, ni signos especiales."
                                                          UserAttributes="@(new Dictionary<string, object> { ["id"] = "nombreEnteInput" })" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField @bind-value="_modelo!.EmpleoCargoComision!.SiglasEntePublico"
                                                          label="SIGLAS DEL ENTE PÚBLICO"
                                                          Disabled="modoVista"
                                                          helpertext="Indicar las siglas del Ente público."
                                                          UserAttributes="@(new Dictionary<string, object> { ["id"] = "siglasEntePublicoInput" })" />
                                        </MudItem>
                                    </MudGrid>
                                </MudPaper>
                            </MudForm>
                           </MudStep>
                        <MudStep Title="6. ORIGEN DEL PROCEDIMIENTO*" CompletedStepColor="Color.Success">
                            <MudForm @ref="_formOrigenProcedimiento" Model="_modelo" @bind-IsValid="_isStep1Valid[5]">
                                <MudPaper Class="pa-4">
                                    <MudGrid>
                                        <MudItem xs="6">
                                            <MudSelect @bind-Value="_modelo!.OrigenProcedimiento!.IdOrigenProcedimientoCatFK"
                                                       Label="Origen Procedimiento"
                                                       Disabled="modoVista"
                                                       Required="!modoVista"
                                                       HelperText="Se deberá señalar el motivo que dio origen a la investigación por la comisión de la falta administrativa grave.">
                                                @foreach (var origen in ListaOrigenesInvestigacion)
                                                {
                                                    <MudSelectItem Value="@origen.IdOrigenProcedimiento">@origen.Descripcion</MudSelectItem>
                                                }
                                            </MudSelect>


                                        </MudItem>
                                        @if (_modelo!.OrigenProcedimiento?.IdOrigenProcedimientoCatFK == 5)
                                        {
                                            <MudItem xs="6">
                                                <MudTextField @bind-value="_modelo!.OrigenProcedimiento!.Valor"
                                                              Disabled="modoVista"
                                                              label="Valor"
                                                              helpertext="En caso de seleccionar la opción OTRO, se deberá especificar el motivo que dio origen a la investigación por la comisión de la falta administrativa grave." />
                                            </MudItem>
                                        }
                                    </MudGrid>
                                </MudPaper>
                            </MudForm>
                        </MudStep>
                        <MudStep Title="7. TIPO DE FALTA COMETIDA POR LA PERSONA MORAL SANCIONADA*" CompletedStepColor="Color.Success">
                            <MudForm @ref="_formTipoFaltaCometida" Model="_modelo" @bind-IsValid="_isStep1Valid[6]">
                                <MudPaper Class="pa-4 mx-auto" Style="max-width: 70vw;">
                                    <MudGrid>
                                        <MudItem xs="6">
                                            <MudSelect @bind-Value="_modelo!.FaltaCometida!.MultipleFalta"
                                                       T="string" MultiSelection="true" @bind-SelectedValues="_optionsFaltaComedia"
                                                       Disabled="modoVista"
                                                       Label="Tipo de Falta Cometida"
                                                       HelperText="Seleccionar del catálogo la (s) falta (s) cometida (s) por la persona servidora pública. Se podrán elegir de las siguientes opciones:">
                                                @foreach (var falta in FaltasCometidas)
                                                {
                                                    <MudSelectItem Value="@falta.Descripcion">@falta.Descripcion</MudSelectItem>
                                                }
                                            </MudSelect>
                                        </MudItem>

                                        @if ((_optionsFaltaComedia ?? Enumerable.Empty<string>()).Contains("OTRO (Especifique)"))
                                        {
                                            <MudItem xs="6">
                                                <MudTextField @bind-value="_modelo!.FaltaCometida!.Valor"
                                                              Disabled="modoVista"
                                                              label="Valor"
                                                              helpertext="En caso de seleccionar la opción OTRO, se deberá especificar el el tipo de falta cometida por parte de la persona servidora pública sancionada." />
                                            </MudItem>
                                        }
                                        <MudItem xs="6">
                                            <MudTextField @bind-value="_modelo!.FaltaCometida!.NombreNormatividad"
                                                          label="NORMATIVIDAD INFRINGIDA"
                                                          Disabled="modoVista"
                                                          required="!modoVista"
                                                          RequiredError="El campo de Normatividad Infringida es obligatorio."
                                                          helpertext="Escribir el nombre de la Normatividad Infringida por la persona servidora pública, sin abreviaturas, sin acentos, ni signos especiales;" />
                                        </MudItem>
                                        <MudItem xs="6">
                                            <MudTextField @bind-value="_modelo!.FaltaCometida!.Articulo"
                                                          label="ARTÍCULO(S) DE LA NORMATIVIDAD INFRINGIDA"
                                                          Disabled="modoVista"
                                                          required="!modoVista"
                                                          RequiredError="El campo de Artículo(s) De La Normatividad Infringida es obligatorio."
                                                          helpertext="Escribir el (los) artículo (s) infringido (s)." />
                                        </MudItem>
                                        <MudItem xs="6">
                                            <MudTextField @bind-value="_modelo!.FaltaCometida!.FraccionNormatividad"
                                                          label="FRACCIÓN(ES) DE LA NORMATIVIDAD INFRINGIDA"
                                                          Disabled="modoVista"
                                                          helpertext="En su caso, escribir la (s) fracción (es) infringida (s)." />
                                        </MudItem>
                                        <MudItem xs="6">
                                            <MudTextField @bind-value="_modelo!.FaltaCometida!.DescripcionHechos"
                                                          label="DESCRIPCIÓN BREVE DE LOS HECHOS"
                                                          Disabled="modoVista"
                                                          required="!modoVista"
                                                          RequiredError="El campo de Descripcion Hechos es obligatorio."
                                                          Lines="4"
                                                          AutoGrow
                                                          helpertext="Redactar una descripción breve de los hechos, sin incluir información reservada o confidencial, de conformidad con la normatividad en materia de transparencia y protección de datos personales." />
                                        </MudItem>
                                    </MudGrid>
                                </MudPaper>

                            </MudForm>
                        </MudStep>
                        <MudStep Title="8. RESOLUCIÓN SANCIONATORIA DE LA FALTA COMETIDA POR LA PERSONA MORAL*" CompletedStepColor="Color.Success">
                            <MudForm @ref="_formResolucionSancionatoria" Model="_modelo" @bind-IsValid="_isStep1Valid[7]">
                                <MudPaper Class="pa-4 mx-auto" Style="max-width: 70vw;">
                                    <MudGrid>
                                        <MudItem xs="4">
                                            <MudTextField @bind-value="_modelo!.Resolucion!.TituloDocumento"
                                                          label="TÍTULO DEL DOCUMENTO"
                                                          required="!modoVista"
                                                          Disabled="modoVista"
                                                          RequiredError="El campo Título Del Documento es obligatorio."
                                                          helpertext="Escribir el Título Del Documento que resuelve el procedimiento de responsabilidad administrativa y que ha quedado firme." />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudDatePicker Label="FECHA DE LA RESOLUCIÓN (DD-MM-AAAA)" @bind-Date="_modelo.Resolucion!.FechaResolucion" required="!modoVista"
                                                           Disabled="modoVista"
                                                           RequiredError="El campo Fecha De La Resolución es obligatorio." helpertext="Colocar la fecha en la que se emite la resolución definitiva." />

                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudDatePicker Label="FECHA DE NOTIFICACIÓN (DD-MM-AAAA)" @bind-Date="_modelo.Resolucion!.FechaNotificacion" required="!modoVista"
                                                           Disabled="modoVista"
                                                           RequiredError="El campo Fecha De Notificación es obligatorio." helpertext="Indicar la fecha en que se notifica la resolución definitiva a la persona servidora pública sancionada." />

                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField @bind-value="_modelo!.Resolucion!.UrlResolucion"
                                                          label="URL DE LA VERSIÓN PÚBLICA DE LA RESOLUCIÓN DESANCIÓN EN FORMATO DIGITAL"
                                                          required="!modoVista"
                                                          Disabled="modoVista"
                                                          RequiredError="El campo URL De La Versión Pública De La Resolución De Sanción En Formato Digital es obligatorio."
                                                          helpertext="Colocar el enlace de la versión pública de la resolución emitida por la autoridad a la que corresponde la sanción." />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudDatePicker Label="FECHA EN QUE ADQUIRIÓ FIRMEZA LA RESOLUCIÓN (DD-MM-AAAA)" @bind-Date="_modelo.Resolucion!.FechaResolucionFirme"
                                                           Disabled="modoVista" required="!modoVista" RequiredError="El campo Fecha En Que Adquirió Firmeza La Resolución es obligatorio."
                                                           helpertext="Colocar la fecha en que adquirió firmeza la resolución de la persona servidora pública." />

                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudDatePicker Label="FECHA DE NOTIFICACIÓN DE LA RESOLUCIÓN FIRME (DD-MM-AAAA)" @bind-Date="_modelo.Resolucion!.FechaNotificacionFirme" required="!modoVista" Disabled="modoVista" RequiredError="El campo Fecha Notificacion Firme es obligatorio."
                                                           helpertext="Indicar la fecha en que se notifica a la persona servidora pública que la resolución ha quedado firme." />

                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField @bind-value="_modelo!.Resolucion!.UrlResolucionFirme"
                                                          Disabled="modoVista"
                                                          label="URL DE LA VERSIÓN PÚBLICA DEL ACUERDO O DETERMINACIÓN QUE DECLARE FIRME LA RESOLUCIÓN EN FORMATO DIGITAL"
                                                          required="!modoVista"
                                                          RequiredError="El campo URL De La Versión Pública Del Acuerdo O Determinación Que Declare Firme La Resolución En Formato Digital es obligatorio."
                                                          helpertext="Colocar el enlace de la versión pública del acuerdo o determinación que dicte la autoridad competente en la que declara que la resolución definitiva ha quedado firme." />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudDatePicker Label="FECHA DE EJECUCIÓN DE LA SANCIÓN (DD-MM-AAAA)" @bind-Date="_modelo.Resolucion!.FechaEjecucion" Disabled="modoVista" helpertext="Anotar la fecha en la que se ejecutó la sanción a la persona servidora pública.
                                                Si al momento de registrar la información la autoridad no cuenta con el dato señalado en el presente numeral, esta podrá registrarse posteriormente mediante una actualización de su registro." />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudSelect @bind-Value="_modelo!.Resolucion!.IdOrdenJurisdiccionalFK"
                                                       Label="ORDEN JURISDICCIONAL"
                                                       Disabled="modoVista"
                                                       Required="!modoVista"
                                                       RequiredError="El campo Orden Jurisdiccional es obligatorio."
                                                       HelperText="Seleccionar la opción correspondiente al orden jurisdiccional del ente público que emitió la resolución:">
                                                @if (OrdenJurisdiccional is not null)
                                                {
                                                    @foreach (var orden in OrdenJurisdiccional)
                                                    {
                                                        <MudSelectItem Value="@orden.Id">@orden.Descripcion</MudSelectItem>
                                                    }
                                                }
                                            </MudSelect>


                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField @bind-value="_modelo!.Resolucion!.AutoridadResolutora"
                                                          Disabled="modoVista"
                                                          label="AUTORIDAD RESOLUTORA"
                                                          required="!modoVista"
                                                          RequiredError="El campo Autoridad Resolutora es obligatorio."
                                                          helpertext="Indicar el nombre de la autoridad facultada para dictar la sanción" />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField @bind-value="_modelo!.Resolucion!.AutoridadInvestigadora"
                                                          label="AUTORIDAD INVESTIGADORA"
                                                          Disabled="modoVista"
                                                          required="!modoVista"
                                                          RequiredError="El campo Autoridad Investigadora es obligatorio."
                                                          helpertext="Especificar el nombre de la autoridad encargada de la investigación de la falta administrativa grave." />
                                        </MudItem>
                                        <MudItem xs="4">
                                            <MudTextField @bind-value="_modelo!.Resolucion!.AutoridadSubstanciadora"
                                                          label="AUTORIDAD SUBSTANCIADORA"
                                                          Disabled="modoVista"
                                                          required="!modoVista"
                                                          RequiredError="El campo Autoridad Substanciadora es obligatorio."
                                                          helpertext="Señalar el nombre de la autoridad substanciadora del procedimiento." />
                                        </MudItem>
                                    </MudGrid>
                                </MudPaper>

                            </MudForm>
                        </MudStep>
                        <MudStep Title="  9. TIPO DE SANCIÓN IMPUESTA A LA PERSONA MORAL*" CompletedStepColor="Color.Success">
                            <MudForm @ref="_formTipoSancionImpuesta" Model="_modelo" @bind-IsValid="_isStep1Valid[8]">
                                <MudPaper Class="pa-4">
                                    <MudGrid>
                                        <MudItem xs="6">
                                            <MudSelect @bind-Value="_modelo!.MultipleSancion"
                                                       @bind-SelectedValues="_options"
                                                       Disabled="modoVista"
                                                       T="string"
                                                       Label="Tipo De Sanción Fisica"
                                                       Required="!modoVista"
                                                       RequiredError="El campo Clave es obligatorio."
                                                       HelperText="Elegir una o varias sanciones, según corresponda..."
                                                       MultiSelection="true">
                                                @foreach (var clave in TipoSancionClaves)
                                                {
                                                    <MudSelectItem Value="@clave.Descripcion">@clave.Descripcion</MudSelectItem>
                                                }
                                            </MudSelect>
                                        </MudItem>
                                    </MudGrid>
                                </MudPaper>
                            </MudForm>

                            @if ((_options ?? Enumerable.Empty<string>()).Contains("INHABILITACIÓN TEMPORAL PARA PARTICIPAR EN ADQUISICIONES,ARRENDAMIENTOS,SERVICIOS U OBRAS PÚBLICAS"))
                            {                                
                                <CardForm>
                                    <Header>
                                        A. INHABILITACIÓN TEMPORAL PARA PARTICIPAR EN ADQUISICIONES, ARRENDAMIENTOS, SERVICIOS U OBRAS PÚBLICAS*
                                    </Header>
                                    <Content>
                                        <MudForm @ref="_formInhabilitacionTemporal" Model="_modelo" @bind-IsValid="_isStep1Valid[10]">
                                            <MudPaper Class="pa-4">
                                                <MudGrid Justify="Justify.FlexStart">
                                                    <MudItem xs="4">
                                                        <MudTextField @bind-value="_modelo!.Inhabilitacion!.Anio"
                                                                      Disabled="modoVista"
                                                                      label="AÑO (S)"
                                                                      required="!modoVista"
                                                                      RequiredError="El campo Año es obligatario." />
                                                    </MudItem>
                                                    <MudItem xs="4">
                                                        <MudTextField @bind-value="_modelo!.Inhabilitacion!.Mes"
                                                                      Disabled="modoVista"
                                                                      label="MES (ES)"
                                                                      required="!modoVista"
                                                                      RequiredError="El campo Mes es obligatario." />
                                                    </MudItem>
                                                    <MudItem xs="4">
                                                        <MudTextField @bind-value="_modelo!.Inhabilitacion!.Dia"
                                                                      Disabled="modoVista"
                                                                      label="DÍA (S)"
                                                                      required="!modoVista"
                                                                      RequiredError="El campo Dia es obligatario." />
                                                    </MudItem>
                                                    <MudItem xs="4">
                                                        <MudDatePicker Label="FECHA INICIAL (DD-MM-AAAA)" @bind-Date="_modelo.Inhabilitacion!.FechaInicial" required="!modoVista" helpertext="Indicar la fecha en la que inició la inhabilitación." Disabled="modoVista" />
                                                       
                                                    </MudItem>
                                                    <MudItem xs="4">
                                                        <MudDatePicker Label="FECHA FINAL (DD-MM-AAAA)" @bind-Date="_modelo.Inhabilitacion!.FechaFinal" required="!modoVista" helpertext="Indicar la fecha en la que se concluyó la inhabilitación." Disabled="modoVista" />
                                                       
                                                    </MudItem>
                                                </MudGrid>
                                            </MudPaper>
                                        </MudForm>
                                    </Content>
                                </CardForm>
                                

                            }
                            @if ((_options ?? Enumerable.Empty<string>()).Contains("INDEMNIZACION"))
                            {                             
                                <CardForm>
                                    <Header>
                                        <MudText Class="text-white">
                                    B. INDEMNIZACIÓN
                                        </MudText>                                        
                                    </Header>
                                    <Content>
                                        <MudForm @ref="_formIndemnizacion" Model="_modelo" @bind-IsValid="_isStep1Valid[11]">
                                            <MudPaper Class="pa-4">
                                                <MudGrid>
                                                    <MudItem xs="4">
                                                        <MudNumericField @bind-value="_modelo!.Indeminizacion!.Monto"
                                                                      Disabled="modoVista"
                                                                      HideSpinButtons="true"
                                                                      label="MONTO"
                                                                      Required="!modoVista"
                                                                      RequiredError="El campo Monto es obligatorio."
                                                                      helpertext="Colocar el monto total de la sanción económica." />
                                                    </MudItem>
                                                    <MudItem xs="4">
                                            
                                                    <MudSelect @bind-Value="_modelo.Indeminizacion.IdTipoMonedaFK"
                                                               Label="MONEDA (Ejemplo: MXN de acuerdo con el ISO 4217)"
                                                               Disabled="modoVista"
                                                               T="int?"
                                                               Required="!modoVista"
                                                               RequiredError="El campo Moneda es obligatorio."
                                                               HelperText="Elegir el tipo de moneda:">
                                                        @foreach (var moneda in TipoMonedas)
                                                        {
                                                            <MudSelectItem Value="@moneda.IdMoneda">@moneda.Descripcion</MudSelectItem>
                                                        }
                                                    </MudSelect>
                                                
                                                                                                            
                                                    </MudItem>
                                                </MudGrid>
                                                <br />
                                                <MudCard>
                                                    <MudCardContent>
                                                        <MudText Typo="Typo.h6" Class="mb-4" Style="color:var(--main-color-general);">
                                                            PLAZO DE PAGO
                                                        </MudText>
                                                    </MudCardContent>
                                                    <MudCardActions>
                                                        <MudGrid>
                                                            <MudItem xs="4">
                                                                <MudTextField @bind-value="_modelo!.PlazoPago!.Anios"
                                                                              Disabled="modoVista"
                                                                              label="AÑO (S)" />
                                                            </MudItem>
                                                            <MudItem xs="4">
                                                                <MudTextField @bind-value="_modelo!.PlazoPago!.Meses"
                                                                              Disabled="modoVista"
                                                                              label="MES (ES)" />
                                                            </MudItem>
                                                            <MudItem xs="4">
                                                                <MudTextField @bind-value="_modelo!.PlazoPago!.Dias"
                                                                              Disabled="modoVista"
                                                                              label="DÍA (S)" />
                                                            </MudItem>
                                                        </MudGrid>
                                                    </MudCardActions>
                                                </MudCard>
                                                <br />
                                                <MudCard Style="background-color:#FFFDE7;">
                                                    <MudCardContent>
                                                        <MudText Typo="Typo.h6" Class="mb-4" Style="color:var(--main-color-general);">INDEMNIZACIÓN EFECTIVAMENTE COBRADA</MudText>
                                                    </MudCardContent>
                                                    <MudCardActions>
                                                        <MudGrid>
                                                            <MudItem xs="6">
                                                                <MudNumericField @bind-value="_modelo!.Indeminizacion.IndeminizacionECobrada!.Monto"
                                                                             HideSpinButtons="true"
                                                                             Disabled="modoVista"
                                                                              label="MONTO"
                                                                              helpertext="Indicar el monto efectivamente cobrado" />
                                                            </MudItem>
                                                            <MudItem xs="6">                                                       
                                                            <MudSelect @bind-Value="_modelo!.Indeminizacion.IndeminizacionECobrada!.IdMonedaFK"
                                                                       Disabled="modoVista"
                                                                       T="int?"
                                                                       Label="MONEDA (Ejemplo: MXN de acuerdo con el ISO 4217)"
                                                                       HelperText="Elegir el tipo de moneda:">
                                                                @foreach (var moneda in TipoMonedas)
                                                                {
                                                                    <MudSelectItem Value="@moneda.IdMoneda">@moneda.Descripcion</MudSelectItem>
                                                                }
                                                            </MudSelect>
                                                  
                                                       
                                                            </MudItem>

                                                            <MudItem xs="6">
                                                        <MudDatePicker Label="FECHA DE COBRO DE LA INDEMNIZACIÓN (DD-MM-AAAA)" @bind-Date="_modelo.Indeminizacion.IndeminizacionECobrada!.FechaCobroSancion" Disabled="modoVista" helpertext="Especificar la fecha en que se realizó el cobro de la sanción económica." />
                                                            </MudItem>
                                                            <MudItem xs="6">
                                                                <MudDatePicker Label="FECHA EN LA QUE SE REALIZÓ EL PAGO TOTAL DE LA INDEMNIZACIÓN (DD-MM-AAAA)" @bind-Date="_modelo.Indeminizacion.IndeminizacionECobrada!.FechaPagoTotalS" Disabled="modoVista" helpertext="Especificar la fecha en que la persona servidora pública cubrió el pago total de la sanción económica." />
                                                            </MudItem>
                                                        </MudGrid>
                                                    </MudCardActions>
                                                </MudCard>
                                            </MudPaper>
                                        </MudForm>
                                    </Content>
                                </CardForm>
                               

                            }
                            @if ((_options ?? Enumerable.Empty<string>()).Contains("SANCION ECONOMICA"))
                    {
                        <CardForm>
                            <Header>
                                C. SANCIÓN ECONÓMICA
                            </Header>
                            <Content>
                                <MudForm @ref="_formSancionEconomica" Model="_modelo" @bind-IsValid="_isStep1Valid[12]">
                                    <MudPaper Class="pa-4 mx-auto" Style="max-width: 70vw;">
                                        <MudGrid>
                                            <MudItem xs="4">
                                                <MudNumericField @bind-value="_modelo!.SancionEconomica!.Monto"
                                                                 Disabled="modoVista"
                                                                 label="MONTO"
                                                                 Required="!modoVista"
                                                                 RequiredError="El campo Monto es obligatorio."
                                                                 helpertext="Colocar el monto total de la sanción económica." />
                                            </MudItem>
                                            <MudItem xs="4">
                                                <MudSelect @bind-Value="_modelo!.SancionEconomica!.IdMonedaFK"
                                                           Label="MONEDA (Ejemplo: MXN de acuerdo con el ISO 4217)"
                                                           Disabled="modoVista"
                                                           T="int?"
                                                           Required="!modoVista"
                                                           RequiredError="El campo Moneda es obligatorio."
                                                           HelperText="Elegir el tipo de moneda:">
                                                    @foreach (var moneda in TipoMonedas)
                                                    {
                                                        <MudSelectItem Value="@moneda.IdMoneda">@moneda.Descripcion</MudSelectItem>
                                                    }
                                                </MudSelect>
                                                @if (_modelo.SancionEconomica!.Moneda is null)
                                                {
                                                    <MudText Typo="Typo.caption" Color="Color.Error">El campo de Moneda es obligatorio.</MudText>
                                                }
                                            </MudItem>                                        


                                                <MudItem xs="4">
                                                    <MudTextField @bind-value="_modelo!.SancionEconomica!.Anio"
                                                                  Disabled="modoVista"
                                                                  label="AÑO (S)" />
                                                </MudItem>

                                                <MudItem xs="4">
                                                    <MudTextField @bind-value="_modelo!.SancionEconomica!.Mes"
                                                                  Disabled="modoVista"
                                                                  label="MES (ES)" />
                                                </MudItem>

                                                <MudItem xs="4">
                                                    <MudTextField @bind-value="_modelo!.SancionEconomica!.Dia"
                                                                  Disabled="modoVista"
                                                                  label="DÍA (S)" />
                                                </MudItem>

                                           
                                        </MudGrid>
                                        <br />
                                        <MudCard>
                                            <MudCardContent>
                                                <MudText Typo="Typo.h6" Class="mb-4" Style="color:var(--main-color-general);">SANCIÓN ECONÓMICA EFECTIVAMENTE COBRADA</MudText>
                                            </MudCardContent>
                                            <MudCardActions>
                                                <MudGrid>
                                                    <MudItem xs="6">
                                                        <MudNumericField @bind-value="_modelo!.SancionEconomica.SancionEfectivamenteCobrada!.Monto"
                                                                         Disabled="modoVista"
                                                                         label="MONTO"
                                                                         helpertext="Indicar el monto efectivamente cobrado" />
                                                    </MudItem>
                                                    <MudItem xs="6">
                                                        <MudSelect @bind-Value="_modelo!.SancionEconomica.SancionEfectivamenteCobrada!.IdMonedaFK"
                                                                   Disabled="modoVista"
                                                                   T="int?"
                                                                   Label="MONEDA (Ejemplo: MXN de acuerdo con el ISO 4217)"
                                                                   HelperText="Elegir el tipo de moneda:">
                                                            @foreach (var moneda in TipoMonedas)
                                                            {
                                                                <MudSelectItem Value="@moneda.IdMoneda">@moneda.Descripcion</MudSelectItem>
                                                            }
                                                        </MudSelect>
                                                    </MudItem>

                                                    <MudItem xs="6">
                                                        <MudDatePicker Label="FECHA DE COBRO DE LA SANCIÓN (DD-MM-AAAA)" @bind-Date="_modelo.SancionEconomica.SancionEfectivamenteCobrada!.FechaCobro" Disabled="modoVista" helpertext="Especificar la fecha en que se realizó el cobro de la sanción económica." />
                                                    </MudItem>
                                                    <MudItem xs="6">
                                                        <MudDatePicker Label="FECHA EN QUE SE REALIZÓ EL PAGO TOTAL DE LA SANCIÓN (DD-MM-AAAA)" @bind-Date="_modelo.SancionEconomica.SancionEfectivamenteCobrada!.FechaPagoTotal" Disabled="modoVista" helpertext="Especificar la fecha en que la persona servidora pública cubrió el pago total de la sanción económica." />
                                                    </MudItem>
                                                </MudGrid>
                                            </MudCardActions>
                                        </MudCard>
                                    </MudPaper>

                                </MudForm>
                            </Content>
                        </CardForm>
                    }
                            @if ((_options ?? Enumerable.Empty<string>()).Contains("SUSPENSION ACTIVIDADES"))
                                {                                  
                                <CardForm>
                                    <Header>
                                        D. SUSPENSIÓN DE ACTIVIDADES*
                                    </Header>
                                    <Content>
                                        <MudForm @ref="_formSuspensionActividades" Model="_modelo" @bind-IsValid="_isStep1Valid[13]">
                                            <MudPaper Class="pa-4">
                                                <MudGrid>
                                                    <MudItem xs="4">
                                                        <MudTextField @bind-value="_modelo!.SuspensionActividades.PlazoSuspensionAnios"
                                                                      Disabled="modoVista"
                                                                      label="AÑO (S)"
                                                                      Required="!modoVista"
                                                                      RequiredError="El campo Monto es obligatorio."
                                                                      helpertext="Colocar el monto total de la sanción económica." />
                                                    </MudItem>
                                                    <MudItem xs="4">
                                                        <MudTextField @bind-value="_modelo!.SuspensionActividades.PlazoSuspensionMeses"
                                                                      Disabled="modoVista"
                                                                      label="MES (ES)"
                                                                      Required="!modoVista"
                                                                      RequiredError="El campo Monto es obligatorio."
                                                                      helpertext="Colocar el monto total de la sanción económica." />
                                                    </MudItem>
                                                    <MudItem xs="4">
                                                        <MudTextField @bind-value="_modelo!.SuspensionActividades.PlazoSuspensionDias"
                                                                      Disabled="modoVista"
                                                                      label="DÍA (S)"
                                                                      Required="!modoVista"
                                                                      RequiredError="El campo Monto es obligatorio."
                                                                      helpertext="Colocar el monto total de la sanción económica." />
                                                    </MudItem>
                                                    <MudItem xs="4">
                                                        <MudDatePicker Label="FECHA INICIAL (DD-MM-AAAA)" @bind-Date="_modelo.SuspensionActividades.FechaInicial" Disabled="modoVista" Required="!modoVista" />
                                                    </MudItem>
                                                    <MudItem xs="4">
                                                        <MudDatePicker Label="FECHA FINAL (DD-MM-AAAA)" @bind-Date="_modelo.SuspensionActividades!.FechaFinal" Disabled="modoVista" Required="!modoVista" />
                                                    </MudItem>

                                                </MudGrid>

                                            </MudPaper>
                                        </MudForm>
                                    </Content>
                                </CardForm>
                                    

                                }
                            @if ((_options ?? Enumerable.Empty<string>()).Contains("DISOLUCION SOCIEDAD"))
                                {                                  
                                    <CardForm>
                                        <Header>
                                            E. DISOLUCIÓN DE LA SOCIEDAD*
                                        </Header>
                                        <Content>
                                            <MudForm @ref="_formDisolucion" @bind-IsValid="_isStep1Valid[14]">
                                                <MudDatePicker Label="Fecha"
                                                               @bind-Date="_modelo!.DisolucionSociedad!.FechaDisolucion"
                                                               Disabled="modoVista"
                                                               Required="!modoVista" />
                                                <MudItem xs="12" class="d-flex justify-center">
                                                </MudItem>
                                            </MudForm>
                                        </Content>
                                    </CardForm>                                    

                                }
                            @if ((_options ?? Enumerable.Empty<string>()).Contains("OTRO (Especifique)"))
                                {
                                    <CardForm>
                                        <Header>
                                            F. OTRO*
                                        </Header>
                                        <Content>
                                            <MudForm @ref="_formOtro" Model="_modelo" @bind-IsValid="_isStep1Valid[15]">
                                                <MudPaper Class="pa-4">
                                                    <MudGrid Justify="Justify.FlexStart">
                                                        <MudItem xs="12">
                                                            <MudTextField @bind-value="_modelo!.Otro!.DenominacionSancion"
                                                                          label="DENOMINACIÓN DE LA SANCIÓN"
                                                                          Disabled="modoVista"
                                                                          required="!modoVista"
                                                                          RequiredError="El campo Denominacion Sancion es obligatorio."
                                                                          helpertext="Indicar el nombre de la sanción, sin abreviaturas, sin acentos, ni signos especiales." />
                                                        </MudItem>
                                                    </MudGrid>
                                                </MudPaper>
                                            </MudForm>
                                        </Content>
                                    </CardForm>                                

                                }
                        </MudStep>

                        <MudStep Title="10. OBSERVACIONES" CompletedStepColor="Color.Success">
                                <MudTextField Label="OBSERVACIONES"
                                              @bind-Value="_modelo.Otro.Observaciones"
                                              Disabled="modoVista"
                                              For="@(() => _modelo.Otro.Observaciones)" />
                            </MudStep>
                     
                    
                      
                       
                        </ChildContent>
            <ActionContent Context="stepper">
                <MudButton EndIcon="@Icons.Material.Filled.NavigateBefore"
                           Color="Color.Primary"
                           OnClick="@(() => stepper.PreviousStepAsync())">
                    Regresar
                </MudButton>

                <MudSpacer />

                @if (stepper.ActiveIndex < stepper.Steps.Count - 1)
                {
                    @if (loading)
                    {
                        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
                    }
                    else
                    {
                        <MudButton StartIcon="@Icons.Material.Filled.NavigateNext"
                                   Color="Color.Primary"
                                   OnClick="@(() => stepper.NextStepAsync())">
                            Pasar al Siguiente
                        </MudButton>
                    }
                }
                else
                {
                    @if (loading)
                    {
                        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
                    }
                    else
                    {
                        <MudButton StartIcon="@Icons.Material.Filled.Check"
                                   Color="Color.Primary"
                                   OnClick="FinalizarRegistro">
                            Finalizar
                        </MudButton>
                    }                    
                }
            </ActionContent>

                    </MudStepper>                            
            </Content>
        </CardForm>
        

@code {
    private async Task OnPreviewInteraction(StepperInteractionEventArgs arg)
    {
        if (arg.Action == StepAction.Complete)
        {
            // occurrs when clicking next
            await ControlStepCompletion(arg);
        }       
    }

    private async Task ControlStepCompletion(StepperInteractionEventArgs arg)
    {
        // 1. Inicia el estado de carga
        loading = true;

        try
        {
            bool isFormValid = false;

            switch (arg.StepIndex)
            {
                case 0:
                    await _formFecha!.Validate();
                    isFormValid = _isStep1Valid[0];
                    if (!isFormValid && !modoVista)
                        arg.Cancel = true;
                    break;
                case 1:
                    await _formExpediente!.Validate();
                    isFormValid = _isStep1Valid[1];
                    if (!isFormValid && !modoVista)
                        arg.Cancel = true;
                    else if (!modoVista)
                    {
                        isFormValid = await GuardarTemporal();
                        if (!isFormValid)
                            arg.Cancel = true;
                    }
                    break;
                case 2:
                    await _formDatosGenerales!.Validate();
                    isFormValid = _isStep1Valid[2];
                    if (!isFormValid && !modoVista)
                        arg.Cancel = true;
                    else if (!modoVista)
                    {
                        isFormValid = await GuardarTemporal();
                        if (!isFormValid)
                            arg.Cancel = true;
                    }
                    break;
                case 3:
                    await _formDatosDirectorGeneral!.Validate();
                    isFormValid = _isStep1Valid[3];
                    if (!isFormValid && !modoVista)
                        arg.Cancel = true;
                    else if (!modoVista)
                    {
                        isFormValid = await GuardarTemporal();
                        if (!isFormValid)
                            arg.Cancel = true;
                    }
                    break;
                case 4:
                    await _formDatosEntePublico!.Validate();
                    isFormValid = _isStep1Valid[4];
                    if (!isFormValid && !modoVista)
                        arg.Cancel = true;
                    else if (!modoVista)
                    {
                        isFormValid = await GuardarTemporal();
                        if (!isFormValid)
                            arg.Cancel = true;
                    }
                    break;
                case 5:
                    await _formOrigenProcedimiento!.Validate();
                    isFormValid = _isStep1Valid[5];
                    if (!isFormValid && !modoVista)
                        arg.Cancel = true;
                    else if (!modoVista)
                    {
                        isFormValid = await GuardarTemporal();
                        if (!isFormValid)
                            arg.Cancel = true;
                    }
                    break;
                case 6:
                    await _formTipoFaltaCometida!.Validate();
                    isFormValid = _isStep1Valid[6];
                    if (!isFormValid && !modoVista)
                        arg.Cancel = true;
                    else if (!modoVista)
                    {
                        isFormValid = await GuardarTemporal();
                        if (!isFormValid)
                            arg.Cancel = true;
                    }
                    break;
                case 7:
                    await _formResolucionSancionatoria!.Validate();
                    isFormValid = _isStep1Valid[7];
                    if (!isFormValid && !modoVista)
                        arg.Cancel = true;
                    else if (!modoVista)
                    {
                        isFormValid = await GuardarTemporal();
                        if (!isFormValid)
                            arg.Cancel = true;
                    }
                    break;
                case 8:                    
                    await _formTipoSancionImpuesta!.Validate();
                    isFormValid = _isStep1Valid[8];
                    if (!isFormValid && !modoVista)
                        arg.Cancel = true;
                    else
                    {
                        if (!modoVista)
                        {
                            var resp = await SwitchToPanel();
                            if (!resp)
                                arg.Cancel = true;
                            else
                            {
                                isFormValid = await GuardarTemporal();
                                if (!isFormValid)
                                    arg.Cancel = true;
                            }
                        }
                       
                    }
                    break;                
            }
        }
        finally
        {
            // 2. Detiene el estado de carga al finalizar la ejecución del método
            loading = false;
        }
    }
        }

     

